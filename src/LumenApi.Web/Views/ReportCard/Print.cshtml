@using LumenApi.Web.ViewModels
@model PrintReportCardData
@{
    Layout = null;
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Neuton:wght@300;400;700&display=swap"
          rel="stylesheet" />
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />

    <style>
        body {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .ft10 {
            font-size: 11px;
            font-family: Times;
            color: #333333;
        }

        .ft11 {
            font-size: 34px;
            font-family: Times;
            color: #333333;
        }

        .ft12 {
            font-size: 15px;
            font-family: Times;
            color: #333333;
        }

        .ft13 {
            font-size: 20px;
            font-family: Times;
            color: #333333;
        }

        .ft14 {
            font-size: 11px;
            font-family: Times;
            color: #333333;
        }

        .ft15 {
            font-size: 12px;
            font-family: Times;
            color: #333333;
        }

        .ft16 {
            font-size: 16px;
            font-family: Times;
            color: #333333;
        }

        .ft17 {
            font-size: 12px;
            line-height: 17px;
            font-family: Times;
            color: #333333;
        }

        .headerTermColumn {
            width: 80px !important;
        }

        table {
            width: 100%;
        }

        table, th, td {
            border: 0.2px solid #00000067;
            border-collapse: collapse;
        }

        .signature {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        @@media print {
            .ft11 {
                font-size: 23px; /* Font size for printing */
            }

            .ft13 {
                font-size: 16px;
            }
        }

        #printT {
            border: 1px solid #ccc;
            padding: 20px;
            margin: 20px;
            width: 7.5in; /* Adjusted width to fit within A4 width */
            height: 10.7in; /* Adjusted height to fit within A4 height */
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
            /*page-break-after: always;*/ /* Force a new page after each card */
        }
        /* Styles for the loader overlay */
        #loader-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent black */
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000; /* Make sure the overlay is on top */
        }

        .loader {
            border: 4px solid #f3f3f3; /* Light grey */
            border-top: 4px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        @@keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @@media print {
            #printT {
                page-break-after: auto; /* or avoid specifying page-break-after */
            }
        }
    </style>

</head>
<body>

    <div class="d-flex justify-content-center align-items-center h-100" id="JsonPrint">
        <div class="d-flex flex-column" id="printColumns">
            <div class="border border-dark mt-3" id="printT">
                <!-- Header section  -->
                <section class="d-flex justify-content-between align-items-center ">
                    <div class="schoollogo1" style="width: 21%">
                        <img src="data:image/jpeg;base64,@ViewBag.School_logo"
                             alt=""
                             style="width: 120px; height: 115px; margin-bottom: 11px;" />
                    </div>
                    <div class="headerContent text-center " style="width:58%">
                        <div class="ft11 mb-0" style="font-size: 1.5rem; font-weight: bold;"><b>@ViewBag.SchoolNewName</b></div>

                        <p class="ft13 mb-0">
                            @ViewBag.newAddress
                        </p>


                        <div class="ft13"><b>Academic Session : @ViewBag.current_Year</b></div>
                        <div class="ft13"><b>Report Card</b></div>
                    </div>
                    <div class="schoollogo1 " style="width:21%">
                        <img src="~/Content/Images/logo3.png"
                             alt=""
                             style="width: 120px; height: 103px;margin-left: 13px;" />
                        <span class="ft14">CISCE Affiliation No. : MP034</span>
                    </div>
                </section>
                <hr class="m-0" />

                <!-- students details  -->
                <section class="ft15 ps-1 my-1">
                    <div class="row">
                        <div class="col-4" style="width: 60%">
                            <span style="margin-right: 5px"><b> Student's Name</b></span>
                            <span class="text-uppercase">
                                : <span style="border-bottom: 1px dashed" id="StudentName">@Model.StudentData.StudentName</span>
                            </span>
                        </div>

                        <div class="col-4" style="width: 40%">
                            <span><b>Class & Section</b></span>
                            <span class="text-uppercase">
                                : <span style="border-bottom: 1px dashed"
                                        id="ClassSection"></span>@Model.StudentData.ClassName - @Model.StudentData.SectionName
                            </span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-4" style="width: 60%">
                            <span style="margin-right: 11px"><b>Father's Name</b> </span>
                            <span class="text-uppercase">
                                : <span style="border-bottom: 1px dashed" id="FatherName">

                                </span> @Model.StudentData.FatherName
                            </span>
                        </div>

                        <div class="col-4" style="width: 40%">
                            <span style="margin-right: 16px"><b>Date of Birth</b></span>
                            <span class="text-uppercase">
                                : <span style="border-bottom: 1px dashed" id="DateOfBirth">

                                </span>@Model.StudentData.DateOfBirth
                            </span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-8" style="width: 60%">
                            <span style="margin-right: 6px"><b>Mother's Name</b></span>
                            <span class="text-uppercase">
                                : <span style="border-bottom: 1px dashed"
                                        id="MotherName">@Model.StudentData.MotherName</span>
                            </span>
                        </div>
                        <div class="col-4" style="width: 40%">
                            <span style="margin-right: 27px"><b>Attendance</b></span>
                            <span class="text-uppercase">
                                : <span style="border-bottom: 1px dashed"
                                        id="Attendance">@Model.StudentData.Attendance</span>
                            </span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-4" style="width: 60%">
                            <span style="margin-right: 44px"><b>Roll No.</b></span>
                            <span class="text-uppercase">
                                :
                                <span style="border-bottom: 1px dashed"
                                      id="RollNo">@Model.StudentData.RollNo</span>
                            </span>
                        </div>
                        <div class="col-4" style="width: 40% ">
                            <span style="margin-right: 26px"><b>Scholar No.</b></span>
                            <span class="text-uppercase">
                                :
                                <span style="border-bottom: 1px dashed"
                                      id="ScholarNo">@Model.StudentData.ScholarNo</span>
                            </span>
                        </div>
                    </div>
                </section>

                <!-- marks section  -->
                <table class="text-center my-2 ft15" id="MarksTable">
                    <tr>
                        <th style="width: 180px;">Scholastic Areas:</th>

                        @if (Model.GroupedTerms.Where(x => x.Term.Contains("UT")).Any())
                        {
                            var colspan = @Model.GroupedTerms.Where(x => x.Term.Contains("UT")).Count() + 2;
                            <th colspan="3" scope="colgroup">Unit Test</th>
                        }

                        @foreach (var col in Model.GroupedTerms.Where(x => !x.Term.Contains("UT")).DistinctBy(x => x.Term))
                        {
                            <th colspan="4" scope="colgroup">@col.Term</th>
                        }
                        <th colspan="2" scope="colgroup">Total</th>
                    </tr>
                    <tr>
                        <th scope="col">Subjects</th>
                        @if (Model.GroupedTerms.Where(x => x.Term.Contains("UT")).Any())
                        {
                            decimal _total = 0;
                            @foreach (var col in Model.GroupedTerms.Where(x => x.Term.Contains("UT")).DistinctBy(x => x.Term))
                            {
                                _total += (decimal)col.MaximumMarks;
                                <th scope="colgroup">@col.Term (@col.MaximumMarks)</th>
                            }
                            <th scope="col">Marks Obt. (@_total)<span id=""></span></th>
                        }
                        @foreach (var col in Model.GroupedTerms.Where(x => !x.Term.Contains("UT")).DistinctBy(x => x.Term))
                        {

                            var theoryTotalMarks = @Model.GroupedTerms.Where(x => x.Term == col.Term && x.TestType == "Theory").Select(x => x.MaximumMarks).FirstOrDefault();
                            var practicalTotalMarks = @Model.GroupedTerms.Where(x => x.Term == col.Term && x.TestType == "Practical").Select(x => x.MaximumMarks).FirstOrDefault();
                            var total = theoryTotalMarks + practicalTotalMarks;
                            <th scope="col">Theory (@theoryTotalMarks)<span class=""></span></th>
                            <th scope="col">Practical  (@practicalTotalMarks) <span id=""></span></th>
                            <th scope="col">Marks Obt. (@total)<span id=""></span></th>
                            <th scope="col">Grade</th>

                        }
                        <th scope="col">Marks</th>
                        <th scope="col">Grade</th>
                    </tr>
                    @if (Model.GroupedSubjects!=null)
                    {
                    @foreach (var row in Model.GroupedSubjects)
                    {

                        @if (!row.IsOptional)
                        {
                            decimal unitTest = 0;

                            decimal total = 0;

                            <tr>
                                <td>@row.SubjectName</td>

                                @foreach (var col in row.Terms.Where(x => x.Name.Contains("UT")).ToList())
                                {
                                    unitTest += (decimal)@col.TheoryMark;
                                    <td>@col.TheoryMark</td>
                                }
                                <td>@unitTest</td>
                                @foreach (var col in row.Terms.Where(x => !x.Name.Contains("UT")).ToList())
                                {
                                    total += (decimal)@col.TotallMark;
                                    <td>@col.TheoryMark</td>
                                    <td>@col.PracticalMark</td>
                                    <td>@col.TotallMark</td>
                                    <td>@col.Grade</td>
                                }
                                <td>@total</td>
                                <td></td>
                            </tr>
                        }

                    }
                    }
                    <tr>
                        <td>Total</td>
                        @{
                            decimal unitTestTotal = 0;
                            decimal tot_total = 0;
                        }
                        @foreach (var col in Model.Term.Where(x => x.Contains("UT")).ToList())
                        {

                            var totalMarkUT = Model.GroupedTerms.Where(a => a.Term == col).Select(x => x.Total).FirstOrDefault();
                            unitTestTotal += (decimal)totalMarkUT;
                            <td>@totalMarkUT</td>

                            tot_total += (decimal)totalMarkUT;
                        }
                        <td>@unitTestTotal</td>
                        @foreach (var col in Model.Term.Where(x => !x.Contains("UT")).ToList())
                        {
                            var totalMarkTheory = Model.GroupedTerms.Where(a => a.Term == col && a.TestType == "Theory").Select(x => x.Total).FirstOrDefault();
                            var totalMarkPractical = Model.GroupedTerms.Where(a => a.Term == col && a.TestType == "Practical").Select(x => x.Total).FirstOrDefault();
                            var sum = totalMarkTheory + totalMarkPractical;
                            <td>@totalMarkTheory</td>
                            <td>@totalMarkPractical</td>
                            <td>@sum</td>
                            <td></td>

                            tot_total += (decimal)sum;
                        }

                        <td>@tot_total</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>Percentage</td>
                        @{
                             decimal _unitTesTotaltPerc = 0;
                             decimal _tot_Total_Perc = 0;
                        }
                        @foreach (var col in Model.Term.Where(x => x.Contains("UT")).ToList())
                        {

                            var ut_perc = Model.GroupedTerms.Where(a => a.Term == col).Select(x => x.Percentage).FirstOrDefault();

                            <td>@ut_perc.ToString("F2")%</td>

                            _unitTesTotaltPerc += ut_perc;
                            _tot_Total_Perc += ut_perc;
                        }
                        @{
                            decimal _unitTestPerc = _unitTesTotaltPerc/2;
                        }
                        <td>@_unitTestPerc.ToString("F2")%</td>
                        @foreach (var col in Model.Term.Where(x => !x.Contains("UT")).ToList())
                        {
                            var ter_perc = Model.GroupedTerms.Where(a => a.Term == col && a.TestType == "Theory").Select(x => x.Percentage).FirstOrDefault();

                            var ter_perc_prac = Model.GroupedTerms.Where(a => a.Term == col && a.TestType == "Practical").Select(x => x.Percentage).FirstOrDefault();

                            var sum = (ter_perc + ter_perc_prac) / 2;
                            <td>@ter_perc.ToString("F2")%</td>
                            <td>@ter_perc_prac.ToString("F2")%</td>
                            <td>@sum.ToString("F2")%</td>
                            <td></td>

                            tot_total += (int)sum;
                            _tot_Total_Perc += ter_perc_prac;
                        }

                       
                        <td>@_unitTestPerc.ToString("F2")%</td>
                        <td></td>
                    </tr>
                    @if(Model.GroupedSubjects!=null)
                    {
                    @foreach (var row in Model.GroupedSubjects)
                    {
                        @if (row.IsOptional)
                        {
                            <tr>
                                <td>@row.SubjectName</td>
                                @if (row.Terms.Where(x => x.Name.Contains("UT")).Any())
                                {
                                    @foreach (var col in row.Terms.Where(x => x.Name.Contains("UT")).ToList())
                                    {

                                        <td>@col.TheoryMark</td>
                                    }
                                }
                                else
                                {
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                }

                                @if (row.Terms.Where(x => !x.Name.Contains("UT")).Any())
                                {
                                    @foreach (var col in row.Terms.Where(x => !x.Name.Contains("UT")).ToList())
                                    {

                                        <td>@col.TheoryMark</td>
                                        <td>@col.PracticalMark</td>
                                        <td>@col.TotallMark</td>
                                        <td>@col.Grade</td>
                                    }
                                }
                                else
                                {
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>-</td>
                                }
                                <td>0</td>
                                <td></td>
                            </tr>
                        }

                    }
                    }
                </table>
                @*

                *@
                <!-- Grading scale  -->
                <table class="text-center ft15" id="coScholasticTable">
                    <tr>
                        <th colspan="6" scope="colgroup">
                            Co-Scholastic Areas [on a 4-point (A-NA) grading scale]
                        </th>
                    </tr>

                    <tr>
                        <th style="width: 300px;">Co-Scholastic Areas</th>
                        <th class="headerTermColumn headerUT1Column" style="width: 65px;">UT-I</th>
                        <th class="headerTermColumn headerUT2Column" style="width:65px;">UT-II</th>
                        <th class="headerTermColumn headerTerm1Column" style="width: 65px;">TERM-I</th>
                        <th class="headerTermColumn headerTerm2Column" style="width:65px;">TERM-II</th>
                        <th class="headerTermColumn headerPreBoard1Column preBoardResult" style="width:65px;">Pre Board-I</th>
                        <th class="headerTermColumn headerPreBoard2Column preBoardResult" style="width:65px;">Pre Board-II</th>


                        <th style="width: 300px;">Co-Scholastic Areas</th>
                        <th class="headerTermColumn headerUT1Column" style="width: 65px;">UT-I</th>
                        <th class="headerTermColumn headerUT2Column" style="width:65px;">UT-II</th>
                        <th class="headerTermColumn headerTerm1Column" style="width:65px;">TERM-I</th>
                        <th class="headerTermColumn headerTerm2Column" style="width:65px;">TERM-II</th>
                        <th class="headerTermColumn headerPreBoard1Column preBoardResult" style="width:65px;">Pre Board-I</th>
                        <th class="headerTermColumn headerPreBoard2Column preBoardResult" style="width:65px;">Pre Board-II</th>

                    </tr>


                </table>




                <!-- Result section  -->
                <div class="d-flex justify-content-between align-items-center px-1">
                    <div class="ft15">
                        <span><b>Result :</b></span>
                        <span id="result"> @Model.Result</span>
                    </div>
                    <div class="ft15">
                        <span><b>Overall Grade :</b></span>
                        <span id="overallGrade"></span>
                    </div>
                </div>
                <div class="ft15 px-1" id="teacherRemark">
                    <span><b>Class Teacher's Remarks : </b></span>
                    <span><span id="teacherRemarkText"></span>  <span id="promotedClass">@Model.StudentData.PromotedClass</span> </span>
                </div>
                <div class="ft15 px-1" id="UnitTestRemark">
                    <span><b>Class Teacher's Remarks : </b></span>
                    <span id="UnitTestRemarkText">@Model.StudentData.Remark</span>
                </div>
                <!-- signature section  -->
                <div class="d-flex justify-content-between align-items-baseline px-3">
                    <div class="signature">
                        <img src="" alt="" />
                        <span class="ft15"><b>Parent / Guardian</b></span>
                    </div>
                    <div class="signature">
                        <img src="@Model.StudentData.StaffSignatureLink" id="teachersignature" style="width:115px; height:60px;" alt="" />
                        <span class="ft15"><b>Class Teacher</b></span>
                    </div>
                    <div class="signature">
                        <img src="~/Content/Images/principle.png" style="width:115px; height:60px;" alt="" />
                        <span class="ft15"><b>Principal</b></span>
                    </div>
                </div>

                <div class="ft15 px-1 mt-2">
                    <span><b>Grading scale for Scholastic Areas : </b></span>
                    <span>Grades are awarded on a 6-point grading scale as follows -</span>
                </div>

                <!-- marks range section  -->
                <table class="text-center ft15" id="GradingCriteria">
                    <tbody class="grate-tbody"></tbody>
                    @*<tr>
                    <th>Range (%)</th>
                    <td><span id="dgrade"></span></td>


                    @foreach (var item in ViewBag.gradingCriteria)
                    {
                    <td>@item.MinimumPercentage - @item.MaximumPercentage</td>
                    }
                    <td>32.5 - 49.4</td>
                    <td>49.5 - 64.4</td>
                    <td>64.5 - 74.4</td>
                    <td>74.5 - 89.4</td>
                    <td>89.5 - 100</td>
                    </tr>
                    <tr>
                    <th>Grade</th>
                    @foreach (var item in ViewBag.gradingCriteria)
                    {
                    <td>@item.Grade</td>
                    }
                    <td>D (Failed)</td>
                    <td>C</td>
                    <td>B</td>
                    <td>B+</td>
                    <td>A</td>
                    <td>A+</td>
                    </tr>*@

                    @*<tr>
                    <td colspan="7" scope="colgroup" class="text-start ps-1 ps-1">
                    <div class="ft15">
                    4.
                    N.B. There will be no second attempt for English Language and
                    Literature. Second attempt is allowed for one subject provided
                    the score is below 35.
                    </div>
                    <div class="ft15">Minimum mark for passing is 35.</div>
                    <div class="ft15">** It Indicates Improvement Exam.</div>
                    </td>
                    </tr>*@
                </table>

                <!-- End  -->
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.0.slim.js" integrity="sha256-7GO+jepT9gJe9LB4XFf8snVOjX3iYNb0FHYr5LI1N5c=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="~/Scripts/DevelopmentJS/PrintReport.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script>
        // Function to handle the printing
        function printDiv() {
            const printContent = document.getElementById("JsonPrint");
            const originalContent = document.body.innerHTML;

            document.body.innerHTML = printContent.outerHTML;
            window.print();

            document.body.innerHTML = originalContent;
        }

        // Attach click event to the 'Print' button
        const printButton = document.getElementById("printButton");
        printButton.addEventListener("click", printDiv);

    </script>
</body>

<!-- Add the 'Print' button -->



</html>
